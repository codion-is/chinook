[#_chinook_tutorial]
= Chinook Tutorial
:toc: left
:imagesdir: images
:root-dir: ../../../..
:dir-source-domain-api: ../../../../chinook-domain-api/src/main/java
:dir-source-domain: ../../../../chinook-domain/src/main/java
:dir-source-client: ../../../../chinook-client/src/main/java
:dir-source-loadtest: ../../../../chinook-load-test/src/main/java
:dir-source-service: ../../../../chinook-service/src/main/java
:dir-source-service-load-test: ../../../../chinook-service-load-test/src/main/java
:dir-source-sql: ../../../../chinook-domain/src/main/resources
:dir-test-source-domain: ../../../../chinook-domain/src/test/java
:dir-test-source-client: ../../../../chinook-client/src/test/java
:dir-test-source-service: ../../../../chinook-service/src/test/java

https://github.com/codion-is/chinook[Chinook Demo on GitHub]

This demo application is based on the Chinook music store sample database.

== Demonstrated functionality

* Custom column type

** <<_album, Album Tags>>

* Database functions

** <<_updatetotalsfunction, UpdateTotalsFunction>>

*** Used in <<_invoicelineeditmodel, InvoiceLineEditModel>>

** <<_createrandomplaylistfunction, CreateRandomPlaylistFunction>>

*** Used in <<_playlisttablemodel, PlaylistTableModel>>

* Custom table cell renderer

** See <<_tracktablepanel, TrackTablePanel>> and <<_albumtablepanel, AlbumTablePanel>>

* Custom table cell editor

** See TrackCellEditorFactory in <<_tracktablepanel, TrackTablePanel>>

* Custom input fields

** <<_coverartpanel, CoverArtPanel>>

** <<_albumtagpanel, AlbumTagPanel>>

*** Used in <<_albumeditpanel, AlbumEditPanel>>

** <<_durationcomponentvalue, DurationComponentValue>>

*** Used in <<_trackeditpanel, TrackEditPanel>> and <<_tracktablepanel, TrackTablePanel>>

* Custom condition panel

** <<_invoiceconditionpanel, InvoiceConditionPanel>>

*** Used in <<_invoiceeditpanel, InvoiceEditPanel>>

* Customizing the table popup menu

** See <<_tracktablepanel, TrackTablePanel>> and <<_playlisttablepanel, PlaylistTablePanel>>

* Custom condition model operators

** See TrackConditionModelFactory in <<_tracktablemodel, TrackTableModel>>

* Custom detail panel layout

** See <<_invoicepanel, InvoicePanel>> and <<_playlistpanel, PlaylistPanel>>

* Edit panel in dialog

** See <<_playlistpanel, PlaylistPanel>> and <<_playlisttracktablepanel, PlaylistTrackTablePanel>>

* Language selection

** See <<_chinookapppanel, ChinookAppPanel>>

* Custom shortcut key

** See <<_chinookapppanel, ChinookAppPanel>>

* Overridden resources

** <<_chinookresources, ChinookResources>>

* Text field selector

** See <<_customereditpanel, CustomerEditPanel>>

* Search field selector

** See <<_invoiceeditpanel, InvoiceEditPanel>>

** <<_trackselectorfactory, TrackSelectorFactory>> Used in

*** <<_invoicelineeditpanel, InvoiceLineEditPanel>>

*** <<_playlisttrackeditpanel, PlaylistTrackEditPanel>>

*** <<_playlisttracktablepanel, PlaylistTrackTablePanel>>

*** <<_trackeditcomponentfactory, TrackEditComponentFactory>>

* Lookup table cleanup

*** <<_artisttablepanel, ArtistTablePanel>>

* Persistance layer used in a web service

** <<_service, ChinookService>>

* Table joins

* Custom condition

** <<_track_domain_implementation, Track>>

* Non-embedded edit panel

* Custom edit control

** <<_employeetablepanel, EmployeeTablePanel>>

* Database migrations

** <<_database_migration, MigrationManager>> - Hybrid JDBC/Entity approach for schema versioning

* Distribution and packaging

** <<_distribution, Distribution>> - JLink/JPackage configuration with modular dependencies

NOTE: For the Gradle build configuration see <<#_build, Build>> section.

This tutorial assumes you have at least skimmed the https://codion.is/doc/{codion-version}/manual/manual.html#_domain_model[Domain model] part of the Codion manual.

== Domain model

=== API

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/is/codion/demos/chinook/domain/api/Chinook.java[tags=chinook]
----

The domain API sections below continue the Chinook class.

=== Implementation

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/domain/ChinookImpl.java[tags=chinook]
----

The domain implementation sections below continue the ChinookImpl class.

== Customers

image::customers.png[]

=== Customer

==== SQL

[source,sql,options="nowrap"]
----
include::{dir-source-sql}/create_schema.sql[tags=customer]
----

==== Domain

===== API

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/is/codion/demos/chinook/domain/api/Chinook.java[tags=customer]
----

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/is/codion/demos/chinook/domain/api/Chinook.java[tags=customerStringFactory]
----

===== Implementation

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/domain/ChinookImpl.java[tags=customer]
----

==== UI

===== CustomerPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/CustomerPanel.java[lines=19..-1]
----

[#_customereditpanel]
===== CustomerEditPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/CustomerEditPanel.java[lines=19..-1]
----

===== CustomerTablePanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/CustomerTablePanel.java[lines=19..-1]
----

=== Invoice

==== SQL

[source,sql,options="nowrap"]
----
include::{dir-source-sql}/create_schema.sql[tags=invoice]
----

==== Domain

===== API

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/is/codion/demos/chinook/domain/api/Chinook.java[tags=invoice]
----

===== Implementation

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/domain/ChinookImpl.java[tags=invoice]
----

[#_updatetotalsfunction]
===== UpdateTotalsFunction

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/domain/ChinookImpl.java[tags=updateTotalsFunction]
----

==== Model

===== InvoiceModel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/model/InvoiceModel.java[lines=19..-1]
----

[#_invoiceeditmodel]
===== InvoiceEditModel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/model/InvoiceEditModel.java[lines=19..-1]
----

==== UI

[#_invoicepanel]
===== InvoicePanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/InvoicePanel.java[lines=19..-1]
----

[#_invoiceeditpanel]
===== InvoiceEditPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/InvoiceEditPanel.java[lines=19..-1]
----

===== InvoiceTablePanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/InvoiceTablePanel.java[lines=19..-1]
----

[#_invoiceconditionpanel]
===== InvoiceConditionPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/InvoiceConditionPanel.java[lines=19..-1]
----

=== Invoice Line

==== SQL

[source,sql,options="nowrap"]
----
include::{dir-source-sql}/create_schema.sql[tags=invoiceLine]
----

==== Domain

===== API

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/is/codion/demos/chinook/domain/api/Chinook.java[tags=invoiceLine]
----

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/is/codion/demos/chinook/domain/api/Chinook.java[tags=invoiceLineTotalProvider]
----

===== Implementation

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/domain/ChinookImpl.java[tags=invoiceLine]
----

==== Model

[#_invoicelineeditmodel]
===== InvoiceLineEditModel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/model/InvoiceLineEditModel.java[lines=19..-1]
----

===== InvoiceLineEditModelTest

[source,java,options="nowrap"]
----
include::{dir-test-source-client}/is/codion/demos/chinook/model/InvoiceLineEditModelTest.java[lines=19..-1]
----

==== UI

[#_invoicelineeditpanel]
===== InvoiceLineEditPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/InvoiceLineEditPanel.java[lines=19..-1]
----

===== InvoiceLineTablePanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/InvoiceLineTablePanel.java[lines=19..-1]
----

== Employees

image::employees.png[]

=== Employee

==== SQL

[source,sql,options="nowrap"]
----
include::{dir-source-sql}/create_schema.sql[tags=employee]
----

==== Domain

===== API

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/is/codion/demos/chinook/domain/api/Chinook.java[tags=employee]
----

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/is/codion/demos/chinook/domain/api/Chinook.java[tags=emailValidator]
----

===== Implementation

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/domain/ChinookImpl.java[tags=employee]
----

==== UI

===== EmployeeEditPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/EmployeeEditPanel.java[lines=19..-1]
----

[#_employeetablepanel]
===== EmployeeTablePanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/EmployeeTablePanel.java[lines=19..-1]
----

== Albums

image::albums.png[]

We start with a few support tables, artist, genre and media type.

=== Artist

==== SQL

[source,sql,options="nowrap"]
----
include::{dir-source-sql}/create_schema.sql[tags=artist]
----

==== Domain

===== API

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/is/codion/demos/chinook/domain/api/Chinook.java[tags=artist]
----

===== Implementation

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/domain/ChinookImpl.java[tags=artist]
----

==== Model

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/model/ArtistTableModel.java[lines=19..-1]
----

==== UI

===== ArtistEditPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/ArtistEditPanel.java[lines=19..-1]
----

[#_artisttablepanel]
===== ArtistTablePanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/ArtistTablePanel.java[lines=19..-1]
----

=== Genre

==== SQL

[source,sql,options="nowrap"]
----
include::{dir-source-sql}/create_schema.sql[tags=genre]
----

==== Domain

===== API

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/is/codion/demos/chinook/domain/api/Chinook.java[tags=genre]
----

===== Implementation

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/domain/ChinookImpl.java[tags=genre]
----

==== UI

===== GenreEditPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/GenreEditPanel.java[lines=19..-1]
----

=== Media Type

==== SQL

[source,sql,options="nowrap"]
----
include::{dir-source-sql}/create_schema.sql[tags=mediaType]
----

==== Domain

===== API

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/is/codion/demos/chinook/domain/api/Chinook.java[tags=mediaType]
----

===== Implementation

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/domain/ChinookImpl.java[tags=mediaType]
----

==== UI

===== MediaTypeEditPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/MediaTypeEditPanel.java[lines=19..-1]
----

=== Artist

==== SQL

[source,sql,options="nowrap"]
----
include::{dir-source-sql}/create_schema.sql[tags=artist]
----

==== Domain

===== API

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/is/codion/demos/chinook/domain/api/Chinook.java[tags=artist]
----

===== Implementation

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/domain/ChinookImpl.java[tags=artist]
----

==== UI

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/ArtistEditPanel.java[lines=19..-1]
----

[#_album]
=== Album

==== SQL

[source,sql,options="nowrap"]
----
include::{dir-source-sql}/create_schema.sql[tags=album]
----

==== Domain

===== API

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/is/codion/demos/chinook/domain/api/Chinook.java[tags=album]
----

===== Implementation

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/domain/ChinookImpl.java[tags=album]
----

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/domain/ChinookImpl.java[tags=tagsConverter]
----

==== Model

===== AlbumModel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/model/AlbumModel.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-test-source-client}/is/codion/demos/chinook/model/AlbumModelTest.java[lines=19..-1]
----

==== UI

===== AlbumPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/AlbumPanel.java[lines=19..-1]
----

[#_albumeditpanel]
===== AlbumEditPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/AlbumEditPanel.java[lines=19..-1]
----

[#_coverartpanel]
===== CoverArtPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/CoverArtPanel.java[lines=19..-1]
----

[#_albumtagpanel]
===== AlbumTagPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/AlbumTagPanel.java[lines=19..-1]
----

[#_albumtablepanel]
===== AlbumTablePanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/AlbumTablePanel.java[lines=19..-1]
----

=== Track

==== SQL

[source,sql,options="nowrap"]
----
include::{dir-source-sql}/create_schema.sql[tags=track]
----

==== Domain

===== Track Domain API

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/is/codion/demos/chinook/domain/api/Chinook.java[tags=track]
----

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/is/codion/demos/chinook/domain/api/Chinook.java[tags=coverFormatter]
----

[#_track_domain_implementation]
===== Track Domain Implementation

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/domain/ChinookImpl.java[tags=track]
----

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/domain/ChinookImpl.java[tags=raisePriceFunction]
----

==== Model

===== TrackEditModel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/model/TrackEditModel.java[lines=19..-1]
----

[#_tracktablemodel]
===== TrackTableModel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/model/TrackTableModel.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-test-source-client}/is/codion/demos/chinook/model/TrackTableModelTest.java[lines=19..-1]
----

==== UI

[#_trackeditpanel]
===== TrackEditPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/TrackEditPanel.java[lines=19..-1]
----

[#_tracktablepanel]
===== TrackTablePanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/TrackTablePanel.java[lines=19..-1]
----

[#_durationcomponentvalue]
===== DurationComponentValue

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/DurationComponentValue.java[lines=19..-1]
----

== Playlists

image::playlists.png[]

=== Playlist

==== SQL

[source,sql,options="nowrap"]
----
include::{dir-source-sql}/create_schema.sql[tags=playlist]
----

==== Domain

===== API

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/is/codion/demos/chinook/domain/api/Chinook.java[tags=playlist]
----

===== Implementation

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/domain/ChinookImpl.java[tags=playlist]
----

[#_createrandomplaylistfunction]
===== CreateRandomPlaylistFunction

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/domain/ChinookImpl.java[tags=createRandomPlaylistFunction]
----

==== Model

[#_playlisteditmodel]
===== PlaylistEditModel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/model/PlaylistEditModel.java[lines=19..-1]
----

[#_playlisttablemodel]
===== PlaylistTableModel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/model/PlaylistTableModel.java[lines=19..-1]
----

==== UI

[#_playlistpanel]
===== PlaylistPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/PlaylistPanel.java[lines=19..-1]
----

===== PlaylistEditPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/PlaylistEditPanel.java[lines=19..-1]
----

[#_playlisttablepanel]
===== PlaylistTablePanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/PlaylistTablePanel.java[lines=19..-1]
----

===== RandomPlaylistParametersPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/RandomPlaylistParametersPanel.java[lines=19..-1]
----

=== Playlist Track

==== SQL

[source,sql,options="nowrap"]
----
include::{dir-source-sql}/create_schema.sql[tags=playlistTrack]
----

==== Domain

===== API

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/is/codion/demos/chinook/domain/api/Chinook.java[tags=playlistTrack]
----

===== Implementation

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/domain/ChinookImpl.java[tags=playlistTrack]
----

==== Model

[#_playlisttrackeditmodel]
===== PlaylistTrackEditModel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/model/PlaylistTrackEditModel.java[lines=19..-1]
----

==== UI

[#_playlisttrackeditpanel]
===== PlaylistTrackEditPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/PlaylistTrackEditPanel.java[lines=19..-1]
----

[#_playlisttracktablepanel]
===== PlaylistTrackTablePanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/PlaylistTrackTablePanel.java[lines=19..-1]
----

[#_trackeditcomponentfactory]
===== TrackEditComponentFactory

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/TrackEditComponentFactory.java[lines=19..-1]
----

[#_trackselectorfactory]
===== TrackSelectorFactory

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/TrackSelectorFactory.java[lines=19..-1]
----

== Application

=== ChinookAppModel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/model/ChinookAppModel.java[lines=19..-1]
----

== UI

[#_chinookapppanel]
=== ChinookAppPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/ChinookAppPanel.java[lines=19..-1]
----

[#_messages]
== Messages

[#_chinookresources]
=== ChinookResources

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/i18n/ChinookResources.java[lines=19..-1]
----

[#_authenticator]
== Authenticator

=== SQL

[source,sql,options="nowrap"]
----
include::{dir-source-sql}/create_schema.sql[tags=user]
----

[#_chinookauthenticator]
=== ChinookAuthenticator

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/server/ChinookAuthenticator.java[lines=19..-1]
----

[#_domain_unit_test]
== Domain unit test

[source,java,options="nowrap"]
----
include::{dir-test-source-domain}/is/codion/demos/chinook/domain/ChinookTest.java[lines=19..-1]
----

[#_load_test]
== Load test

[source,java,options="nowrap"]
----
include::{dir-source-loadtest}/is/codion/demos/chinook/client/loadtest/ChinookLoadTest.java[lines=19..-1]
----

=== Scenarios

[source,java,options="nowrap"]
----
include::{dir-source-loadtest}/is/codion/demos/chinook/client/loadtest/scenarios/LoadTestUtil.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-source-loadtest}/is/codion/demos/chinook/client/loadtest/scenarios/InsertDeleteAlbum.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-source-loadtest}/is/codion/demos/chinook/client/loadtest/scenarios/LogoutLogin.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-source-loadtest}/is/codion/demos/chinook/client/loadtest/scenarios/RandomPlaylist.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-source-loadtest}/is/codion/demos/chinook/client/loadtest/scenarios/RaisePrices.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-source-loadtest}/is/codion/demos/chinook/client/loadtest/scenarios/UpdateTotals.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-source-loadtest}/is/codion/demos/chinook/client/loadtest/scenarios/ViewAlbum.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-source-loadtest}/is/codion/demos/chinook/client/loadtest/scenarios/ViewCustomerReport.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-source-loadtest}/is/codion/demos/chinook/client/loadtest/scenarios/ViewGenre.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-source-loadtest}/is/codion/demos/chinook/client/loadtest/scenarios/ViewInvoice.java[lines=19..-1]
----

[#_database_migration]
== Database Migration

This section demonstrates a hybrid approach to database migrations, combining raw JDBC for executing migration scripts with Codion's entity framework for tracking migration history.

=== Migration SQL Scripts

==== V1: Initial Schema

[source,sql,options="nowrap"]
----
include::{dir-source-sql}/db/migration/V1__Initial_schema.sql[]
----

==== V2: Add Track Play Count

[source,sql,options="nowrap"]
----
include::{dir-source-sql}/db/migration/V2__Add_track_play_count.sql[]
----

==== V3: Add Preferences

[source,sql,options="nowrap"]
----
include::{dir-source-sql}/db/migration/V3__Add_preferences.sql[]
----

=== MigrationManager

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/migration/MigrationManager.java[lines=19..-1]
----

=== MigrationDomain

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/migration/MigrationDomain.java[lines=19..-1]
----

=== MigrationManagerTest

[source,java,options="nowrap"]
----
include::{dir-test-source-domain}/is/codion/demos/chinook/migration/MigrationManagerTest.java[lines=19..-1]
----

=== Preferences

The Preferences entity demonstrates how migrations can add new tables to an existing schema.

==== Domain

===== API

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/is/codion/demos/chinook/domain/api/Chinook.java[tags=preferences]
----

===== Implementation

[source,java,options="nowrap"]
----
include::{dir-source-domain}/is/codion/demos/chinook/domain/ChinookImpl.java[tags=preferences]
----

==== UI

===== PreferencesEditPanel

[source,java,options="nowrap"]
----
include::{dir-source-client}/is/codion/demos/chinook/ui/PreferencesEditPanel.java[lines=19..-1]
----

[#_service]
== Service

[source,java,options="nowrap"]
----
include::{dir-source-service}/is/codion/demos/chinook/service/ChinookService.java[lines=19..-1]
----

=== Connection

[source,java,options="nowrap"]
----
include::{dir-source-service}/is/codion/demos/chinook/service/connection/ConnectionSupplier.java[lines=19..-1]
----

=== Handlers

[source,java,options="nowrap"]
----
include::{dir-source-service}/is/codion/demos/chinook/service/handler/AbstractHandler.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-source-service}/is/codion/demos/chinook/service/handler/ArtistHandler.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-source-service}/is/codion/demos/chinook/service/handler/AlbumHandler.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-source-service}/is/codion/demos/chinook/service/handler/TrackHandler.java[lines=19..-1]
----

=== Unit test

[source,java,options="nowrap"]
----
include::{dir-test-source-service}/is/codion/demos/chinook/service/ChinookServiceTest.java[lines=19..-1]
----

[#_service_load_test]
== Service load test

[source,java,options="nowrap"]
----
include::{dir-source-service-load-test}/is/codion/demos/chinook/service/loadtest/ChinookServiceLoadTest.java[lines=19..-1]
----

=== Scenarios

[source,java,options="nowrap"]
----
include::{dir-source-service-load-test}/is/codion/demos/chinook/service/loadtest/scenarios/ArtistById.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-source-service-load-test}/is/codion/demos/chinook/service/loadtest/scenarios/Artists.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-source-service-load-test}/is/codion/demos/chinook/service/loadtest/scenarios/NewArtist.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-source-service-load-test}/is/codion/demos/chinook/service/loadtest/scenarios/AlbumById.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-source-service-load-test}/is/codion/demos/chinook/service/loadtest/scenarios/Albums.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-source-service-load-test}/is/codion/demos/chinook/service/loadtest/scenarios/TrackById.java[lines=19..-1]
----

[source,java,options="nowrap"]
----
include::{dir-source-service-load-test}/is/codion/demos/chinook/service/loadtest/scenarios/Tracks.java[lines=19..-1]
----

== Module Info

=== Domain

==== API

[source,java,options="nowrap"]
----
include::{dir-source-domain-api}/module-info.java[lines=19..-1]
----

==== Implementation

[source,java,options="nowrap"]
----
include::{dir-source-domain}/module-info.java[lines=19..-1]
----

=== Client

[source,java,options="nowrap"]
----
include::{dir-source-client}/module-info.java[lines=19..-1]
----

=== Load Test

[source,java,options="nowrap"]
----
include::{dir-source-loadtest}/module-info.java[lines=19..-1]
----

== Build

=== buildSrc

.settings.gradle
[%collapsible]
====
[source,kotlin,options="nowrap"]
----
include::{root-dir}/buildSrc/settings.gradle[]
----
====

.build.gradle.kts
[%collapsible]
====
[source,kotlin,options="nowrap"]
----
include::{root-dir}/buildSrc/build.gradle.kts[tag=**]
----
====

.chinook.jasperreports.modules.gradle
[%collapsible]
====
[source,groovy,options="nowrap"]
----
include::{root-dir}/buildSrc/src/main/groovy/chinook.jasperreports.modules.gradle[]
----
====

.chinook.jasperreports.pdf.modules.gradle
[%collapsible]
====
[source,groovy,options="nowrap"]
----
include::{root-dir}/buildSrc/src/main/groovy/chinook.jasperreports.pdf.modules.gradle[]
----
====

.chinook.spotless.plugin.gradle
[%collapsible]
====
[source,groovy,options="nowrap"]
----
include::{root-dir}/buildSrc/src/main/groovy/chinook.spotless.plugin.gradle[]
----
====

=== Project

==== Properties
.gradle.properties
[%collapsible]
====
[source,options="nowrap"]
----
include::{root-dir}/gradle.properties[]
----
====

==== Settings

.settings.gradle
[%collapsible]
====
[source,kotlin,options="nowrap"]
----
include::{root-dir}/settings.gradle[]
----
====

==== Build

.build.gradle.kts
[%collapsible]
====
[source,kotlin,options="nowrap"]
----
include::{root-dir}/build.gradle.kts[tag=**]
----
====

== Modules

=== chinook-domain-api

.build.gradle.kts
[%collapsible]
====
[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-domain-api/build.gradle.kts[tag=**]
----
====

=== chinook-domain

.build.gradle.kts
[%collapsible]
====
[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-domain/build.gradle.kts[tag=**]
----
====

=== chinook-domain-generator

NOTE: Configuration only, domain-generator.

.build.gradle.kts
[%collapsible]
====
[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-domain-generator/build.gradle.kts[tag=**]
----
====

=== chinook-client

.build.gradle.kts
[%collapsible]
====
[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-client/build.gradle.kts[tag=**]
----
====

=== chinook-client-local

NOTE: Configuration only, client with a local JDBC connection.

.build.gradle.kts
[%collapsible]
====
[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-client-local/build.gradle.kts[tag=**]
----
====

=== chinook-client-remote

NOTE: Configuration only, client with a remote connection.

.build.gradle.kts
[%collapsible]
====
[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-client-remote/build.gradle.kts[tag=**]
----
====

=== chinook-client-http

NOTE: Configuration only, client with an HTTP connection.

.build.gradle.kts
[%collapsible]
====
[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-client-http/build.gradle.kts[tag=**]
----
====

=== chinook-load-test

.build.gradle.kts
[%collapsible]
====
[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-load-test/build.gradle.kts[tag=**]
----
====

=== chinook-load-test-remote

NOTE: Configuration only, load test with a remote connection.

.build.gradle.kts
[%collapsible]
====
[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-load-test-remote/build.gradle.kts[tag=**]
----
====

=== chinook-load-test-http

NOTE: Configuration only, load test with an HTTP connection.

.build.gradle.kts
[%collapsible]
====
[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-load-test-http/build.gradle.kts[tag=**]
----
====

=== chinook-server

NOTE: Configuration only, runs the server the chinook domain.

.build.gradle.kts
[%collapsible]
====
[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-server/build.gradle.kts[tag=**]
----
====

=== chinook-server-monitor

NOTE: Configuration only, server-monitor.

.build.gradle.kts
[%collapsible]
====
[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-server-monitor/build.gradle.kts[tag=**]
----
====

=== chinook-service

.build.gradle.kts
[%collapsible]
====
[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-service/build.gradle.kts[tag=**]
----
====

=== chinook-service-load-test

.build.gradle.kts
[%collapsible]
====
[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-service-load-test/build.gradle.kts[tag=**]
----
====

[#_distribution]
== Distribution

This section covers the distribution setup for the Chinook application, demonstrating how to create native installers and custom runtime images using jlink and jpackage. The configuration leverages the https://github.com/beryx/badass-jlink-plugin[Badass JLink Plugin] and custom module handling to create multiple distribution variants from a single codebase.

=== Overview

The Chinook project creates several distribution variants:

* **Client distributions**: Local, Remote (RMI), and HTTP connections
* **Server distributions**: Application server and monitoring tools
* **Load test distributions**: Performance testing tools for different connection types
* **Service distribution**: REST API server

Each distribution is carefully configured to include only the necessary dependencies and modules, resulting in optimized runtime images.

=== Key Plugins and Tools

==== Badass JLink Plugin

The https://github.com/beryx/badass-jlink-plugin[Badass JLink Plugin] (`org.beryx.jlink`) is the cornerstone of the distribution setup. It solves the fundamental problem that jlink cannot work with automatic modules by taking a pragmatic approach: **combining all non-modular dependencies into a single merged module**.

NOTE: Applying the Badass JLink Plugin automatically applies the Application plugin, providing access to `mainClass`, `applicationDefaultJvmArgs`, and other application configuration properties.

Key capabilities:

* **Custom Runtime Images**: Creates optimized Java runtime images containing only required modules
* **Native Installers**: Generates platform-specific installers (.msi, .deb, .dmg) via jpackage
* **Automatic Module Handling**: Converts non-modular JARs into explicit modules automatically
* **Cross-Platform Builds**: Support for targeting multiple platforms from a single build
* **Dependency Management**: Handles complex modular and non-modular dependency graphs

==== Extra-Java-Module-Info Plugin

The https://github.com/gradlex-org/extra-java-module-info[Extra Java Module Info Plugin] (`org.gradlex.extra-java-module-info`) addresses a fundamental limitation: **adding proper module information to libraries that lack it**. This enables Gradle to place these dependencies on the module path during compilation, testing, and execution.

**Core Problem Solved:**

Many legacy libraries either:
- Have no module information at all (plain JARs)
- Are automatic modules (unreliable `Automatic-Module-Name`)
- Have broken or incomplete `module-info.class` files

**Plugin Capabilities:**

* **Module Transformation**: Converts non-modular JARs to explicit modules with full `module-info.class`
* **Dependency Resolution**: Properly handles `requires`, `exports`, `opens` directives
* **Service Provider Integration**: Automatically converts `META-INF/services` to `provides...with` declarations
* **Split Package Resolution**: Merges JARs or removes packages to resolve conflicts
* **Automatic Module Enhancement**: Upgrades automatic modules to full modules

===== Chinook's Implementation

Chinook implements this through custom Gradle plugins in `buildSrc` that demonstrate advanced techniques:

**chinook.jasperreports.modules.gradle** - Core Dependencies:

[source,groovy,options="nowrap"]
----
include::{root-dir}/buildSrc/src/main/groovy/chinook.jasperreports.modules.gradle[]
----

**Key Techniques Shown:**
- **Simple Module Definition**: `module("coords", "module.name")` for basic conversion
- **Dependency Mapping**: Converting Maven coordinates to module names

**chinook.jasperreports.pdf.modules.gradle** - Advanced Patterns:

[source,groovy,options="nowrap"]
----
include::{root-dir}/buildSrc/src/main/groovy/chinook.jasperreports.pdf.modules.gradle[]
----

**Advanced Techniques Demonstrated:**

**Critical JasperReports Pattern:**

[source,groovy]
----
module("net.sf.jasperreports:jasperreports-pdf", "net.sf.jasperreports.pdf") {
    closeModule()
    exports("net.sf.jasperreports.export.pdf")
    // ... other exports
}
----

WARNING: The most important technique here is converting `jasperreports-pdf` from an automatic module to a **closed explicit module**. This prevents the Badass JLink Plugin's merged module from overwriting `jasperreports_extension.properties` files, which would cause incredibly hard to debug runtime errors.

**Advanced Configuration Methods:**

* **`closeModule()`** - Creates a closed module (no automatic exports)
* **`exports("package")`** - Explicitly controls package visibility
* **`requires("module")`** - Declares module dependencies
* **`exportAllPackages()`** - Exports all packages found in the JAR
* **`requireAllDefinedDependencies()`** - Auto-generates requires from metadata

===== Plugin Configuration Options

**Basic Module Definition:**

[source,groovy]
----
extraJavaModuleInfo {
    module("commons-beanutils:commons-beanutils", "org.apache.commons.beanutils") {
        exports("org.apache.commons.beanutils")
        requires("java.sql")
        requires("java.desktop")
        requiresTransitive("org.apache.commons.logging")
    }
}
----

**Automatic Module Creation:**

[source,groovy]
----
automaticModule("commons-logging:commons-logging", "org.apache.commons.logging")
----

**Advanced Features:**

* **Split Package Resolution**: `mergeJar("other-coordinates")` or `removePackage("problematic.package")`
* **Service Provider Control**: `ignoreServiceProvider("service.interface", "impl.class")`
* **Broken Module Fixes**: `patchRealModule()` and `preserveExisting()`
* **Classifier Support**: Handle JARs with classifiers like `"artifact|linux-x86_64"`

===== Best Practices from Chinook

. **Convention Plugin Approach**: Apply via buildSrc for consistent multi-project configuration
. **Conservative Exports**: Use `closeModule()` and explicit `exports()` instead of `exportAllPackages()`
. **Service Provider Awareness**: Let the plugin auto-convert `META-INF/services` to `provides...with`
. **Automatic to Explicit**: Convert problematic automatic modules to explicit modules for better control
. **Split Package Prevention**: Address split packages early to avoid runtime issues

===== Common Use Cases

**Legacy Library Integration:**

[source,groovy]
----
module("old-library:old-library", "old.library") {
    exportAllPackages()
    requireAllDefinedDependencies()
}
----

**JavaFX Libraries (Common Pattern):**

[source,groovy]
----
module("javafx-library:javafx-library", "javafx.library") {
    requires("javafx.controls")
    requires("javafx.fxml")
    exports("com.library.javafx")
}
----

**Fixing Broken Modules:**

[source,groovy]
----
module("broken:library", "broken.library") {
    patchRealModule()  // Overwrite existing module-info.class
    requires("missing.dependency")
}
----

=== Configuration-Only Modules

Several modules exist solely to create different distribution configurations. They contain no code, only build configuration:

* `chinook-client-local` - Client with embedded database connection
* `chinook-client-remote` - Client using RMI for remote connections
* `chinook-client-http` - Client using HTTP for remote connections
* `chinook-load-test-remote` - Load testing tool using RMI
* `chinook-load-test-http` - Load testing tool using HTTP

Each configuration module:

. Depends on the base implementation module
. Adds connection-specific dependencies
. Configures jlink/jpackage for that specific use case

=== JLink Configuration Techniques

==== Common JLink Options

All distributions use these optimization options:

[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-client-local/build.gradle.kts[tags=jlinkBasic]
----

Standard optimization options:

* `--strip-debug` - Removes debug information to reduce image size
* `--no-header-files` - Excludes C header files (reduces size)
* `--no-man-pages` - Excludes manual pages (reduces size)

==== Advanced Module Management

The server distribution demonstrates sophisticated techniques:

[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-server/build.gradle.kts[tags=jlinkAdvanced]
----

===== Key Configuration Methods

**`addExtraDependencies(String... jarPrefixes)`**

Treats JARs matching given prefixes as dependencies of the merged module. Essential for libraries that don't declare all their dependencies:

* **Use case**: Libraries using JavaFX often don't specify JavaFX dependencies (removed from JDK in Java 11)
* **Chinook usage**: `addExtraDependencies("slf4j-api")` handles SLF4J's missing runtime dependencies

**`forceMerge(String... jarPrefixes)`**

Forces modular JARs to be treated as non-modular and included in the merged module:

* **Use case**: Resolves split package conflicts or cyclic dependencies
* **Chinook usage**: `forceMerge("kotlin")` handles Kotlin's split packages across multiple runtime JARs

**`mergedModule.excludeRequires(String... modules)`**

Removes specific module requirements from the generated merged module descriptor:

* **Use case**: Eliminates problematic or unnecessary module dependencies
* **Chinook usage**: `excludeRequires("jetty.servlet.api")` removes conflicting Jetty requirements

**Advanced jlink Options**

* `--ignore-signing-information` - Bypasses JAR signature verification (essential when dependencies contain signed JARs)
* `--add-modules` - Explicitly includes runtime-only modules not detected by dependency analysis

===== How the Plugin Works

The plugin implements a sophisticated module merging strategy:

. **Identifies non-modular JARs** in the dependency graph
. **Combines them into a single merged module** with generated module descriptor
. **Creates delegating modules** for each original non-modular dependency
. **Resolves cyclic dependencies** by automatically detecting and merging problematic modular JARs
. **Generates optimized module graph** suitable for jlink processing

==== Resource Handling

Copy resources (configuration files, keystores) into the jlink build:

[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-server/build.gradle.kts[tags=resourceCopy]
----

This ensures resources like `logback.xml`, `truststore.jks`, and `keystore.jks` are available in the runtime image.

==== Signed JAR Handling

When dependencies contain signed JARs, the `--ignore-signing-information` option is used (see the advanced jlink configuration above).

=== JPackage Configuration

The jpackage integration creates professional, platform-specific installers from the jlink runtime images.

==== Platform-Specific Installers

Each platform gets appropriate installer configuration:

[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-server/build.gradle.kts[tags=jpackagePlatforms]
----

**Platform-Specific Features:**

* **Linux**: Creates .deb packages with desktop shortcuts and menu integration
* **Windows**: Creates .msi installers with Start menu integration, desktop shortcuts, and console output for server applications
* **macOS**: Creates .dmg disk images with drag-and-drop installation

**Key Configuration Options:**

* `installerType` - Specifies installer format (msi, deb, dmg, rpm, etc.)
* `installerOptions` - Platform-specific installer options (--win-menu, --linux-shortcut, etc.)
* `imageOptions` - Runtime image options (--win-console for server applications)
* `icon` - Platform-specific application icons (.ico, .png, .icns)

==== Advanced JPackage Features

**Application Metadata:**

* `appVersion` - Application version for installer metadata
* `vendor` - Vendor name for installer properties
* `installerName` / `imageName` - Control application naming

**Resource Management:**

* `resourceDir` - Custom resources for installer customization
* `outputDir` - Consolidated output directory for both images and installers

**Cross-Platform Considerations:**

* **Single Platform**: jpackage can only create installers for the platform it runs on
* **CI/CD Integration**: Use GitHub Actions or similar for multi-platform builds
* **Target Platform**: Use `targetPlatformName` when combined with jlink's `targetPlatform` method

==== Dynamic Naming Strategy

Chinook uses dynamic naming to include version and platform information:

* **Pattern**: `{project-name}-{version}-{platform}`
* **Benefits**: Easy identification, parallel builds, artifact organization
* **Implementation**: Automatic OS detection with `OperatingSystem.current()`

=== Example: Client Distribution Variants

Let's examine how different client distributions are configured:

==== chinook-client-local

Local embedded database connection:

[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-client-local/build.gradle.kts[tag=**]
----

Key aspects:

* Includes H2 database driver
* No remote connection dependencies
* Simpler module requirements

==== chinook-client-remote

RMI-based remote connection:

[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-client-remote/build.gradle.kts[tag=**]
----

Key aspects:

* Includes RMI proxy implementation
* Adds `truststore.jks` for secure connections
* Additional RMI-related modules

==== chinook-client-http

HTTP-based remote connection:

[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-client-http/build.gradle.kts[tag=**]
----

Key aspects:

* Includes HTTP proxy implementation
* No truststore needed (uses system trust)
* Lighter module requirements

=== Server Distribution Configuration

The server distribution demonstrates advanced techniques:

[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-server/build.gradle.kts[tag=**]
----

Notable configurations:

* `--ignore-signing-information` for signed dependencies
* Console output on Windows with `--win-console`
* Includes both `keystore.jks` and serialization filter patterns
* Force merges Kotlin modules

=== GitHub Release Integration

All distributions integrate with GitHub releases:

[source,kotlin,options="nowrap"]
----
include::{root-dir}/chinook-client-local/build.gradle.kts[tags=githubRelease]
----

This automatically uploads both the jlink ZIP and native installers to GitHub releases when the `githubAccessToken` property is provided.

=== Troubleshooting Distribution Issues

==== Module Resolution Problems

**Module Not Found Errors:**

. **Check modularity**: Use `jar --describe-module <jar-file>` to verify if dependency is modular
. **Add missing dependencies**: Use `addExtraDependencies("jar-prefix")` for libraries with undeclared dependencies
. **Include runtime modules**: Add runtime-only modules explicitly with `--add-modules`
. **Examine module graph**: Run `suggestMergedModuleInfo` task to see recommended module descriptor

**Cyclic Dependency Issues:**

. The plugin automatically detects and resolves most cycles by merging problematic modular JARs
. Use `forceMerge("jar-prefix")` to manually force modular JARs into the merged module
. Check the plugin's console output for automatic cycle resolution messages

==== Dependency and Resource Conflicts

**"Duplicate Resource" Errors:**

. **JasperReports Pattern**: Convert automatic modules to full modules to prevent resource file overwrites
. **Custom Exclusions**: Use `excludeResources` patterns in `mergedModule` block
. **Split Package Issues**: Use `forceMerge()` to consolidate conflicting packages

**Missing Runtime Resources:**

. **Resource Copy Strategy**: Use `prepareMergedJarsDir` task customization to copy resources
. **Module Accessibility**: Ensure module-info.java has proper `opens` directives for reflection access
. **Classpath Resources**: Verify resources are in the correct module location

**Signed JAR Issues:**

. **Signature Verification**: Use `--ignore-signing-information` option for signed dependencies
. **Mixed Signatures**: Consider the impact on security when bypassing signature verification

==== Platform and Build Issues

**Cross-Platform Builds:**

. **Target Platform Limitations**: jpackage can only create installers for the current platform
. **JDK Compatibility**: Ensure target platform JDK versions match source platform requirements
. **Path Separators**: Use platform-neutral path handling in custom scripts

**Performance and Size Issues:**

. **Image Size**: Use `--strip-debug`, `--no-header-files`, `--no-man-pages` for smaller images
. **Module Selection**: Review included modules with `jdeps` to identify unnecessary dependencies
. **Compression**: Consider jlink's `--compress` option (levels 0-2)

**JVM and Application Issues:**

. **Memory Settings**: Configure appropriate JVM memory settings for target environments
. **Environment Variables**: Use Mustache syntax `{{VAR_NAME}}` for environment variable substitution
. **Path Resolution**: Use `{{BIN_DIR}}` placeholder for relative path calculations

==== Common Plugin Configuration Mistakes

**Incorrect Module Names:**

. Verify `moduleName` matches your module-info.java declaration
. Ensure `mergedModuleName` doesn't conflict with existing modules

**Application Configuration Issues:**

. Verify `mainClass` and `mainModule` are correctly configured

**Resource Directory Issues:**

. Check that custom resource directories exist before plugin execution
. Verify resource copying happens in the correct task lifecycle phase

=== Best Practices and Lessons Learned

==== Development and Configuration

. **Start Simple**: Begin with basic jlink configuration and gradually add complexity
. **Use Suggested Module Info**: Run `suggestMergedModuleInfo` task to understand plugin recommendations
. **Separate Concerns**: Use configuration-only modules (like Chinook's client variants) for different distribution types
. **Document Module Requirements**: Clearly document why each module is included and any special handling

==== Dependency Management

. **Handle Non-Modular Dependencies Early**: Use extra-java-module-info plugin to convert automatic modules
. **Address Split Packages**: Use `forceMerge()` for libraries with package conflicts (like Kotlin runtime)
. **Minimize Dependencies**: Regularly review and remove unnecessary dependencies to reduce image size
. **Test Dependency Changes**: Verify that dependency updates don't break module resolution

==== Performance and Size Optimization

. **Standard Optimization**: Always use `--strip-debug`, `--no-header-files`, `--no-man-pages`
. **Compression**: Consider `--compress` option for further size reduction (trade-off with startup time)
. **Module Selection**: Use `jdeps` to analyze and eliminate unnecessary module dependencies
. **Resource Cleanup**: Remove unused resources and files from the final image

==== Build and Release Management

. **Dynamic Naming**: Include version and platform in image names for easy identification
. **Automated Testing**: Create tests that verify each distribution variant works correctly
. **CI/CD Integration**: Use GitHub Actions or similar for multi-platform builds
. **Artifact Management**: Organize build outputs clearly and consistently

==== Platform Considerations

. **Test on Target Platforms**: Don't rely solely on cross-compilation; test actual installers
. **Platform-Specific Resources**: Provide appropriate icons and resources for each platform
. **Installation Paths**: Consider platform conventions for installation directories
. **Security Implications**: Understand the impact of `--ignore-signing-information` on security

==== Resource and Configuration Management

. **Centralized Resources**: Use `prepareMergedJarsDir` customization for resource copying
. **Environment Variables**: Use Mustache syntax for flexible configuration
. **Path Handling**: Use plugin-provided placeholders like `{{BIN_DIR}}` for portable scripts
. **Configuration Files**: Ensure application configuration files are properly included

==== Advanced Techniques (Chinook-Specific Insights)

. **JasperReports Pattern**: Convert automatic modules to explicit modules to prevent resource conflicts
. **Hybrid Module Systems**: Combine entity framework patterns with raw JDBC using appropriate module boundaries
. **Connection Abstraction**: Use configuration modules to provide different connection types (local, RMI, HTTP)
. **Service Layer Modularity**: Separate domain, service, and client layers for maximum flexibility

==== Troubleshooting Strategy

. **Incremental Debugging**: Isolate issues by temporarily removing complex dependencies
. **Plugin Diagnostics**: Use plugin's diagnostic output to understand automatic decisions
. **Module Graph Analysis**: Understand the final module graph structure and dependency flow
. **Build Reproducibility**: Ensure builds are reproducible across different environments

The Chinook distribution setup demonstrates that while creating modular Java applications with native installers requires careful configuration, the Badass JLink Plugin's sophisticated dependency management combined with proper module design patterns make it achievable even with complex dependencies like JasperReports, Kotlin runtimes, and multi-tier architectures.